<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Living Soil Calculator - Grow With Les v1.5</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f4f1ed; }
        h1 { color: #2c3e50; }
        label, select, input { display: block; margin-bottom: 10px; }
        .output { margin-top: 20px; background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .footer { margin-top: 40px; font-size: 0.9em; color: gray; }
        .timer { background: #ffeeba; border: 1px solid #f0ad4e; padding: 10px; border-radius: 8px; margin-top: 20px; }
        .planty-tip {
            margin-top: 20px;
            background-color: #e0f7fa;
            border-left: 5px solid #00acc1;
            padding: 15px;
            border-radius: 8px;
            font-style: italic;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <h1>Living Soil Calculator – Grow With Les</h1>

    <label for="strain">Strain Name:</label>
    <input type="text" id="strain" placeholder="e.g., Blueberry OG">

    <label for="plantType">What Type of Plant?</label>
    <select id="plantType">
        <option value="" disabled selected>Select an option</option>
        <option>Photoperiod – Indica-Dominant</option>
        <option>Photoperiod – Sativa-Dominant</option>
        <option>Autoflower – Indica-Dominant</option>
        <option>Autoflower – Sativa-Dominant</option>
        <option>Hybrid (Photo or Auto)</option>
        <option>Custom / Unknown</option>
    </select>

    <label for="feeding">How Hungry is Your Plant? (Feeding Intensity)</label>
    <select id="feeding">
        <option value="" disabled selected>Select an option</option>
        <option>Heavy Feeder 🐘</option>
        <option>Moderate Feeder 🐕</option>
        <option>Light Feeder 🐇</option>
        <option>I don’t know yet 🤷‍♂️</option>
    </select>

    <label for="soil">Choose Your Soil Base:</label>
    <select id="soil">
        <option value="" disabled selected>Select an option</option>
        <option>FoxFarm Ocean Forest</option>
        <option>Happy Frog</option>
        <option>BuildASoil 3.0</option>
        <option>Mother Earth Terracraft</option>
        <option>Coast of Maine Stonington Blend</option>
        <option>Custom Mix (User-defined)</option>
    </select>

    <label for="gallons">How Many Gallons of Soil Do You Need?</label>
    <input type="number" id="gallons" min="1" placeholder="e.g., 10">

    <label><input type="checkbox" id="unitToggle"> Show recipe in % by volume instead of Cups/Gallons</label>
    <label><input type="checkbox" id="includeAlfalfa"> Include Alfalfa Meal</label>

    <label for="cookStart">When did you start cooking your soil?</label>
    <input type="date" id="cookStart">

    <button onclick="calculateMix()">Calculate My Soil Mix</button>
    <button onclick="resetForm()">Reset</button>

    <div class="output" id="output" aria-live="polite">
        <h2>Your Soil Recipe Will Appear Here</h2>
        <p>Fill out the form and click the button to calculate your mix.</p>
    </div>

    <div class="planty-tip" id="plantyTip"></div>

    <div class="footer">
        Version: v1.5 – Now featuring Planty's Tips & a softer new look.
    </div>

    <script>
    function calculateMix() {
        const missingFields = []; // Ensure this is reset before adding new fields
        const strain = document.getElementById('strain').value;
        const plantType = document.getElementById('plantType').value;
        const feeding = document.getElementById('feeding').value;
        const soil = document.getElementById('soil').value;
        const gallonsInput = document.getElementById('gallons');
        const gallons = parseFloat(gallonsInput.value);
        const percentMode = document.getElementById('unitToggle').checked;
        const includeAlfalfa = document.getElementById('includeAlfalfa').checked;
        const cookStart = document.getElementById('cookStart').value;

        const tip = document.getElementById('plantyTip');

        // Validate required fields
        if (!strain || !plantType || !feeding || !soil) {
            if (!strain) missingFields.push(document.getElementById('strain'));
            if (!plantType) missingFields.push(document.getElementById('plantType'));
            if (!feeding) missingFields.push(document.getElementById('feeding'));
            if (!soil) missingFields.push(document.getElementById('soil'));

            missingFields.forEach(field => {
                field.style.border = '2px solid red';
            });

            let plantyMessage = "🌱 Planty says: Let's get those blanks filled in before we mix!";
            if (!strain) plantyMessage = "🌱 Planty says: What strain are we growing? Gotta name your baby!";
            else if (!plantType) plantyMessage = "🌱 Planty says: Pick your plant type so I know how it grows.";
            else if (!feeding) plantyMessage = "🌱 Planty says: Tell me how hungry your plant is — I won’t judge!";
            else if (!soil) plantyMessage = "🌱 Planty says: What soil are we starting with? I need the dirt on your dirt!";
            tip.innerHTML = plantyMessage;
            document.getElementById('output').innerHTML = `<p style='color:red;'>Please fill in all required fields.</p>`;
            missingFields[0].scrollIntoView({ behavior: 'smooth' });
            return;
        } else {
            document.getElementById('strain').style.border = '';
            document.getElementById('plantType').style.border = '';
            document.getElementById('feeding').style.border = '';
            document.getElementById('soil').style.border = '';
        }

        // Validate gallons input
        if (isNaN(gallons) || gallons <= 0) {
            gallonsInput.style.border = '2px solid red';
            tip.innerHTML = "🌱 Planty says: Please enter a valid positive number of gallons.";
            return;
        } else {
            gallonsInput.style.border = ''; // Reset border on valid input
        }

        // Validate cookStart date
        if (cookStart) {
            const now = new Date();
            const startDate = new Date(cookStart);

            if (startDate > now) {
                document.getElementById('cookStart').style.border = '2px solid red';
                tip.innerHTML = "🌱 Planty says: The start date cannot be in the future. Please enter a valid date.";
                return;
            } else {
                document.getElementById('cookStart').style.border = ''; // Reset border on valid input
            }
        }

        // Generate Planty Tip
        tip.innerHTML = `${getPlantyTip(plantType, feeding)}<br>${getRandomTip()}`;

        // Continue with rest of the existing calculation logic here...
        document.getElementById('output').innerHTML = `<p>Your soil mix has been calculated successfully!</p>`;
    }

    function getPlantyTip(plantType, feeding) {
        if (plantType.includes("Auto")) {
            return "🌱 Planty says: Autos are sensitive! We’ve toned down the amendment strength just for them.";
        }
        if (feeding.includes("Heavy")) {
            return "🌱 Planty says: You picked a heavy feeder — don’t skimp on compost and microbial life.";
        }
        if (feeding.includes("Light")) {
            return "🌱 Planty says: Light feeders thrive in balanced soil — keep it mellow, don’t go overboard.";
        }
        return "🌱 Planty says: Balanced feeding and rich soil lead to happy roots. Let’s mix it right!";
    }

    function getRandomTip() {
        const tips = [
            "🌱 Worm castings are a great source of nutrients for your plants!",
            "🌱 Turn your soil weekly to keep it active and aerated.",
            "🌱 Adding mycorrhizal fungi can supercharge your plant's root system.",
            "🌱 Overwatering is one of the most common mistakes in gardening.",
            "🌱 Healthy soil = healthy plants. Focus on building microbial life in your mix.",
            "🌱 Compost tea can give your plants a quick nutrient boost!",
            "🌱 Mulching helps retain moisture and suppress weeds in your garden.",
            "🌱 Always let your soil cook for at least 4 weeks for the best results.",
            "🌱 Adding biochar can improve soil structure and nutrient retention.",
            "🌱 Keep an eye on pH levels to ensure your plants can absorb nutrients effectively."
        ];
        const randomIndex = Math.floor(Math.random() * tips.length);
        return tips[randomIndex];
    }
</script>
</body>
</html>
